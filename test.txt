const TelegramBot = require('node-telegram-bot-api');
const axios = require('axios');
const bot = new TelegramBot('YOUR_BOT_TOKEN', { polling: true });

// Start command with inline keyboard
bot.onText(/\/start/, (msg) => {
  const chatId = msg.chat.id;
  const opts = {
    reply_markup: {
      inline_keyboard: [
        [{ text: 'Generate New Mail 📧', callback_data: 'generate_mail' }],
        [{ text: 'Info ℹ️', callback_data: 'info' }]
      ]
    }
  };
  bot.sendMessage(chatId, `Hello 👋 ${msg.from.first_name}`, opts);
});

// Callback query handler
bot.on('callback_query', async (callbackQuery) => {
  const chatId = callbackQuery.message.chat.id;
  const action = callbackQuery.data;

  switch (action) {
    case 'generate_mail':
      try {
        // Make a request to generate a disposable email address
        const response = await axios.get('https://www.1secmail.com/api/v1/?action=genRandomMailbox&count=1');
        const disposableEmail = response.data[0];
        bot.sendMessage(chatId, `Here is your disposable email address: ${disposableEmail} \n to view latest mails type /fetchemails`);
      } catch (error) {
        console.error('Error generating disposable email address:', error);
        bot.sendMessage(chatId, 'Error generating disposable email address. Please try again later.');
      }
      break;

    case 'info':
      bot.sendMessage(chatId, 'For more information or assistance, please contact the developer:\n\nSurajit Sen\nTelegram: @sensurajit');
      break;

    default:
      // Do nothing
      break;
  }
});

// Handle /fetchemails command
bot.onText(/\/fetchemails/, async (msg) => {
  const chatId = msg.chat.id;
  try {
    // Fetch emails logic
    bot.sendMessage(chatId, "This is where you'll handle fetching emails.");
  } catch (error) {
    console.error('Error fetching emails:', error);
    bot.sendMessage(chatId, 'Error fetching emails. Please try again later.');
  }
});

// Handle errors
bot.on('polling_error', (error) => {
  console.log(error);
});

console.log('Bot is running...');
